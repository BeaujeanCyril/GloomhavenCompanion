@page "/scenarios"

@using GloomhavenCompanion.ViewModels
@inject AppState AppState
@inject NavigationManager Navigation

<PageTitle>Scénarios de la Campagne</PageTitle>

<MudGrid>
  @if (AppState.CurrentCampaign != null && AppState.CurrentCampaign.Scenarios.Count > 0)
  {
    @foreach (var scenario in AppState.CurrentCampaign.Scenarios.Values.OrderBy(s => s.Id))
    {
      <MudItem xs="6" sm="4" md="3" lg="2">
        <MudCard @onclick="() => NavigateToGame(scenario.Id)" Style="max-width: 100%; height: auto;">
          <MudCardMedia Image="@scenario.ImagePath" Title="@scenario.Name" Style="height: 150px; object-fit: cover;" />
        </MudCard>
      </MudItem>

    }
  }
  else
  {
    <MudText>No scenarios found for the current campaign.</MudText>
  }
</MudGrid>

@code {
  private void NavigateToGame(int scenarioId)
  {
    // Mise à jour de l'état de l'application pour le scénario sélectionné
    var selectedScenario = AppState.CurrentCampaign.Scenarios.Values
                                .FirstOrDefault(s => s.Id == scenarioId);
    if (selectedScenario != null)
    {
      AppState.CurrentGame = new GameViewModel();  // Crée un nouveau jeu pour ce scénario
      AppState.CurrentGame.AddNewRound();  // Ajoute le premier round

      // Mettez à jour le scénario en cours dans l'état de l'application
      AppState.CurrentScenario = selectedScenario;
    }

    // Navigation vers la page du jeu en passant le scénario sélectionné
    Navigation.NavigateTo($"/game/{scenarioId}");
  }
}
